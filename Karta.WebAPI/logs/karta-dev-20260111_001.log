[2026-01-11 17:40:57.339 +01:00 WRN]  CONNECTION_STRING environment variable is not set. Using: DefaultConnection from config {"MachineName":"DESKTOP-JSRTU6C","ThreadId":1}
[2026-01-11 17:40:57.428 +01:00 INF]  Connection string sources - Env: NULL, Config: NULL, Default: Server=localhost,1433;Database=KartaDb;User Id=sa;Password=KartaPassword2024!;TrustServerCertificate=true;MultipleActiveResultSets=true; {"MachineName":"DESKTOP-JSRTU6C","ThreadId":1}
[2026-01-11 17:40:57.429 +01:00 INF]  Database connection: Type=SQL Server, ConnectionString=Server=localhost,1433;Database=KartaDb;User Id=sa;Password=***;TrustServerCertificate=true;MultipleActiveResultSets=true; {"MachineName":"DESKTOP-JSRTU6C","ThreadId":1}
[2026-01-11 17:40:57.437 +01:00 INF]  Registered SQL Server database provider with connection string: Server=localhost,1433;Database=KartaDb;User Id=sa;Password=***;TrustServerCertificate=true;MultipleActiveResultSets=true; {"MachineName":"DESKTOP-JSRTU6C","ThreadId":1}
[2026-01-11 17:40:57.780 +01:00 INF]  Starting Karta.ba Web API {"MachineName":"DESKTOP-JSRTU6C","ThreadId":1}
[2026-01-11 17:40:57.829 +01:00 INF] Microsoft.AspNetCore.DataProtection.KeyManagement.XmlKeyManager User profile is available. Using 'C:\Users\User\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest. {"EventId":{"Id":63,"Name":"UsingProfileAsKeyRepositoryWithDPAPI"},"MachineName":"DESKTOP-JSRTU6C","ThreadId":1}
[2026-01-11 17:40:57.844 +01:00 INF] Karta.Service.Services.PaymentMonitorService PaymentMonitorService: Initializing Stripe API key. Env var present: false, Config present: true {"MachineName":"DESKTOP-JSRTU6C","ThreadId":1}
[2026-01-11 17:40:57.850 +01:00 INF] Karta.Service.Services.PaymentMonitorService PaymentMonitorService: Stripe API key initialized successfully. Key prefix: sk_test_51 {"MachineName":"DESKTOP-JSRTU6C","ThreadId":1}
[2026-01-11 17:40:57.911 +01:00 INF] Karta.WebAPI.Services.DatabaseInitializationService Database initialization service starting... {"MachineName":"DESKTOP-JSRTU6C","ThreadId":7}
[2026-01-11 17:40:57.911 +01:00 INF] Karta.WebAPI.Services.DatabaseInitializationService Waiting 5000ms for database server to be ready... {"MachineName":"DESKTOP-JSRTU6C","ThreadId":7}
[2026-01-11 17:40:57.910 +01:00 INF] Karta.WebAPI.Services.EventArchiveService EventArchiveService started. Check interval: "01:00:00" {"MachineName":"DESKTOP-JSRTU6C","ThreadId":8}
[2026-01-11 17:40:57.910 +01:00 INF] Karta.WebAPI.Services.OrderCleanupService OrderCleanupService started. Cleanup interval: "01:00:00", Expiration threshold: "1.00:00:00" {"MachineName":"DESKTOP-JSRTU6C","ThreadId":5}
[2026-01-11 17:40:57.929 +01:00 INF] Karta.Service.Services.PaymentMonitorService ðŸ’³ Payment Monitor Service pokrenuta - provjerava svake 30 sekundi {"MachineName":"DESKTOP-JSRTU6C","ThreadId":7}
[2026-01-11 17:40:57.937 +01:00 INF] Karta.WebAPI.Services.DailyResetService Daily Reset Service started {"MachineName":"DESKTOP-JSRTU6C","ThreadId":9}
[2026-01-11 17:40:57.947 +01:00 INF] Karta.WebAPI.Services.DailyResetService Next reset scheduled at: 2026-01-12 00:00:00 UTC (in 7.3 hours) {"MachineName":"DESKTOP-JSRTU6C","ThreadId":9}
[2026-01-11 17:40:58.045 +01:00 ERR] Microsoft.Extensions.Hosting.Internal.Host Hosting failed to start {"EventId":{"Id":11,"Name":"HostedServiceStartupFaulted"},"MachineName":"DESKTOP-JSRTU6C","ThreadId":1}
System.IO.IOException: Failed to bind to address http://127.0.0.1:8080: address already in use.
 ---> Microsoft.AspNetCore.Connections.AddressInUseException: Only one usage of each socket address (protocol/network address/port) is normally permitted.
 ---> System.Net.Sockets.SocketException (10048): Only one usage of each socket address (protocol/network address/port) is normally permitted.
   at System.Net.Sockets.Socket.UpdateStatusAfterSocketErrorAndThrowException(SocketError error, Boolean disconnectOnFailure, String callerName)
   at System.Net.Sockets.Socket.DoBind(EndPoint endPointSnapshot, SocketAddress socketAddress)
   at System.Net.Sockets.Socket.Bind(EndPoint localEP)
   at Microsoft.AspNetCore.Server.Kestrel.Transport.Sockets.SocketTransportOptions.CreateDefaultBoundListenSocket(EndPoint endpoint)
   at Microsoft.AspNetCore.Server.Kestrel.Transport.Sockets.SocketConnectionListener.Bind()
   --- End of inner exception stack trace ---
   at Microsoft.AspNetCore.Server.Kestrel.Transport.Sockets.SocketConnectionListener.Bind()
   at Microsoft.AspNetCore.Server.Kestrel.Transport.Sockets.SocketTransportFactory.BindAsync(EndPoint endpoint, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Infrastructure.TransportManager.BindAsync(EndPoint endPoint, ConnectionDelegate connectionDelegate, EndpointConfig endpointConfig, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.KestrelServerImpl.<>c__DisplayClass28_0`1.<<StartAsync>g__OnBind|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.AddressBinder.BindEndpointAsync(ListenOptions endpoint, AddressBindContext context, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.AddressBinder.BindEndpointAsync(ListenOptions endpoint, AddressBindContext context, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.LocalhostListenOptions.BindAsync(AddressBindContext context, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.AddressBinder.AddressesStrategy.BindAsync(AddressBindContext context, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.AddressBinder.BindAsync(ListenOptions[] listenOptions, AddressBindContext context, Func`2 useHttps, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.KestrelServerImpl.BindAsync(CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.KestrelServerImpl.StartAsync[TContext](IHttpApplication`1 application, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Hosting.GenericWebHostService.StartAsync(CancellationToken cancellationToken)
   at Microsoft.Extensions.Hosting.Internal.Host.<StartAsync>b__14_1(IHostedService service, CancellationToken token)
   at Microsoft.Extensions.Hosting.Internal.Host.ForeachService[T](IEnumerable`1 services, CancellationToken token, Boolean concurrent, Boolean abortOnFirstException, List`1 exceptions, Func`3 operation)
[2026-01-11 17:40:58.073 +01:00 INF] Karta.WebAPI.Services.DailyResetService Daily Reset Service is stopping due to cancellation {"MachineName":"DESKTOP-JSRTU6C","ThreadId":11}
[2026-01-11 17:40:58.071 +01:00 ERR] Microsoft.Extensions.Hosting.Internal.Host BackgroundService failed {"EventId":{"Id":9,"Name":"BackgroundServiceFaulted"},"MachineName":"DESKTOP-JSRTU6C","ThreadId":9}
System.Threading.Tasks.TaskCanceledException: A task was canceled.
   at Karta.Service.Services.PaymentMonitorService.ExecuteAsync(CancellationToken stoppingToken) in C:\Users\User\Desktop\Karta.ba-main\Karta.Service\Services\PaymentMonitorService.cs:line 66
   at Microsoft.Extensions.Hosting.Internal.Host.TryExecuteBackgroundServiceAsync(BackgroundService backgroundService)
[2026-01-11 17:40:58.074 +01:00 INF] Karta.WebAPI.Services.DailyResetService Daily Reset Service stopped {"MachineName":"DESKTOP-JSRTU6C","ThreadId":11}
[2026-01-11 17:40:58.073 +01:00 FTL]  Application terminated unexpectedly {"MachineName":"DESKTOP-JSRTU6C","ThreadId":1}
System.IO.IOException: Failed to bind to address http://127.0.0.1:8080: address already in use.
 ---> Microsoft.AspNetCore.Connections.AddressInUseException: Only one usage of each socket address (protocol/network address/port) is normally permitted.
 ---> System.Net.Sockets.SocketException (10048): Only one usage of each socket address (protocol/network address/port) is normally permitted.
   at System.Net.Sockets.Socket.UpdateStatusAfterSocketErrorAndThrowException(SocketError error, Boolean disconnectOnFailure, String callerName)
   at System.Net.Sockets.Socket.DoBind(EndPoint endPointSnapshot, SocketAddress socketAddress)
   at System.Net.Sockets.Socket.Bind(EndPoint localEP)
   at Microsoft.AspNetCore.Server.Kestrel.Transport.Sockets.SocketTransportOptions.CreateDefaultBoundListenSocket(EndPoint endpoint)
   at Microsoft.AspNetCore.Server.Kestrel.Transport.Sockets.SocketConnectionListener.Bind()
   --- End of inner exception stack trace ---
   at Microsoft.AspNetCore.Server.Kestrel.Transport.Sockets.SocketConnectionListener.Bind()
   at Microsoft.AspNetCore.Server.Kestrel.Transport.Sockets.SocketTransportFactory.BindAsync(EndPoint endpoint, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Infrastructure.TransportManager.BindAsync(EndPoint endPoint, ConnectionDelegate connectionDelegate, EndpointConfig endpointConfig, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.KestrelServerImpl.<>c__DisplayClass28_0`1.<<StartAsync>g__OnBind|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.AddressBinder.BindEndpointAsync(ListenOptions endpoint, AddressBindContext context, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.AddressBinder.BindEndpointAsync(ListenOptions endpoint, AddressBindContext context, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.LocalhostListenOptions.BindAsync(AddressBindContext context, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.AddressBinder.AddressesStrategy.BindAsync(AddressBindContext context, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.AddressBinder.BindAsync(ListenOptions[] listenOptions, AddressBindContext context, Func`2 useHttps, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.KestrelServerImpl.BindAsync(CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.KestrelServerImpl.StartAsync[TContext](IHttpApplication`1 application, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Hosting.GenericWebHostService.StartAsync(CancellationToken cancellationToken)
   at Microsoft.Extensions.Hosting.Internal.Host.<StartAsync>b__14_1(IHostedService service, CancellationToken token)
   at Microsoft.Extensions.Hosting.Internal.Host.ForeachService[T](IEnumerable`1 services, CancellationToken token, Boolean concurrent, Boolean abortOnFirstException, List`1 exceptions, Func`3 operation)
   at Microsoft.Extensions.Hosting.Internal.Host.<StartAsync>g__LogAndRethrow|14_3(<>c__DisplayClass14_0&)
   at Microsoft.Extensions.Hosting.Internal.Host.StartAsync(CancellationToken cancellationToken)
   at Microsoft.Extensions.Hosting.HostingAbstractionsHostExtensions.RunAsync(IHost host, CancellationToken token)
   at Microsoft.Extensions.Hosting.HostingAbstractionsHostExtensions.RunAsync(IHost host, CancellationToken token)
   at Microsoft.Extensions.Hosting.HostingAbstractionsHostExtensions.Run(IHost host)
   at Program.<Main>$(String[] args) in C:\Users\User\Desktop\Karta.ba-main\Karta.WebAPI\Program.cs:line 269
[2026-01-11 17:40:58.075 +01:00 FTL] Microsoft.Extensions.Hosting.Internal.Host The HostOptions.BackgroundServiceExceptionBehavior is configured to StopHost. A BackgroundService has thrown an unhandled exception, and the IHost instance is stopping. To avoid this behavior, configure this to Ignore; however the BackgroundService will not be restarted. {"EventId":{"Id":10,"Name":"BackgroundServiceStoppingHost"},"MachineName":"DESKTOP-JSRTU6C","ThreadId":9}
System.Threading.Tasks.TaskCanceledException: A task was canceled.
   at Karta.Service.Services.PaymentMonitorService.ExecuteAsync(CancellationToken stoppingToken) in C:\Users\User\Desktop\Karta.ba-main\Karta.Service\Services\PaymentMonitorService.cs:line 66
   at Microsoft.Extensions.Hosting.Internal.Host.TryExecuteBackgroundServiceAsync(BackgroundService backgroundService)
